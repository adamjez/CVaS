"use strict";function AlgorithmClient(n,t,i){var r;i===undefined&&(i={messageHideDelay:5e3,slideUpDuration:500,checkForRunInterval:10,runsEndpoint:"/runs",filesEndpoint:"/files"});r=this;this.options=i;this.algorithmEndpoint=n;this.createRequestBodyCallback=t;zip.workerScriptsPath="/lib/zipjs/WebContent/";var e=function(n,t,i){var u=$(`<div>
                <div class="alert alert-info alert-dismissible request-message" role="alert" >
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    <div class="body-request-message">
                    </div>
                </div >
            </div>`),f;u.find(".body-request-message").html("<p>"+n+" "+t+"<\/p><p>BODY: "+i+"<\/p>");$("#messages-container").append(u);f=u.find(".request-message");f.alert();f.delay(r.options.messageHideDelay).slideUp(r.options.slideUpDuration,function(){u.remove()})},o=function(n){var t="info";return t=n.toUpperCase()==="success".toUpperCase()?"success":n.toUpperCase()==="timeouted".toUpperCase()?"warning":"danger",'<span class="label label-'+t+'">'+n+"<\/span>"},s=function(n,t,i){$.ajax({type:"GET",url:r.options.runsEndpoint+"/"+n,timeout:0,headers:{accept:"application/json"},success:function(n){f(n.id,n.status,n.duration,n.stdOut,n.stdErr,n.file,t,i)}})},h=function(n,t,i){var u=document.createElement("button"),f,e;u.innerHTML="Cancel";t.append('<p class="status-message"><b>Checking again automatically<\/b><\/p>');t.append('<div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"><\/div><\/div>');f=r.options.checkForRunInterval;e=setInterval(function(){if(f<=0)clearInterval(e),s(n,t,i);else{var o=100/r.options.checkForRunInterval,u=100- --f*o;t.find(".progress-bar").css("width",u+"%").attr("aria-valuenow",u)}},1e3);u.onclick=function(){return clearInterval(e),t.find(".status-message").html("<b>Canceled<\/b>"),!1};t.append(u)},u=function(n,t){var u=n.find("div.qq-upload-input-image"),r,i;u.removeClass("qq-image-full-width");r=n.find("div.qq-upload-output-image");r.addClass("qq-output-image-added");i=n.find("div.resultImg");i.prepend('<a class="result-preview" href="#"><img class="result-preview" src="'+t+'"/><\/a>');i.find("a.result-preview").click(function(n){return $.featherlight('<img src="'+t+'"/>'),n.preventDefault(),!1})},c=function(n,t){zip.createReader(new zip.HttpReader(t),function(t){t.getEntries(function(i){i.forEach(function(i){i.getData(new zip.BlobWriter("application/octet-stream"),function(i){t.close();u(n,URL.createObjectURL(i))})})})},onerror)},f=function(n,t,i,r,f,e,s,l){if(s.html(""),s.append("<p>Id: "+n+"<\/p>"),s.append("<p>Status: "+o(t)+"<\/p>"),i!==undefined&&s.append("<p>Duration: "+(i/1e3).toFixed(2)+" s<\/p>"),t==="notFinished"){h(n,s,l);return}r!==undefined&&r.trim()!==""&&s.append("<p>StdOut: "+r+"<\/p>");f!==undefined&&f.trim()!==""&&s.append("<p>StdErr: "+f+"<\/p>");e!==undefined&&(s.append('<p>File: <a href= "'+e+'">download<\/a><\/p>'),$.ajax({type:"HEAD",url:e,success:function(n,t,i){var r=i.getResponseHeader("Content-Type");r==="application/zip"?c(l,e):u(l,e)},error:function(){console.error("HTTP HEAD on "+e+" failed.")}}))},l=function(n,t,i){var u=$("li[qq-file-id='"+i+"']"),o=u.find(".loader"),s=u.find("div.result"),l=u.find("div.qq-upload-images"),c=r.createRequestBodyCallback(t),h;if(c===null){s.append("<p><b>Upload next image to trigger algorithm run<\/b><\/p>");return}h=JSON.stringify(c);o.show();e("POST",r.algorithmEndpoint,h);$.ajax({type:"POST",url:r.algorithmEndpoint,data:h,timeout:0,headers:{accept:"application/json"},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){o.hide();f(n.id,n.status,n.duration,n.stdOut,n.stdErr,n.file,s,l)},complete:function(){o.hide()},error:function(){s.append("<p><b>Something bad happened. Contact admin, please<\/b><\/p>")}})};qq.deprecatedParseJson=qq.parseJson;qq.parseJson=function(n){return{success:!0,data:qq.deprecatedParseJson(n)}};$("#fine-uploader-gallery").fineUploader({template:"qq-template-gallery",request:{endpoint:r.options.filesEndpoint},deleteFile:{enabled:!1,endpoint:r.options.filesEndpoint},thumbnails:{placeholders:{waitingPath:"/lib/fine-uploader/dist/placeholders/waiting-generic.png",notAvailablePath:"/lib/fine-uploader/dist/placeholders/not_available-generic.png"}},validation:{allowedExtensions:["jpeg","jpg","gif","png","bmp"]},callbacks:{onComplete:function(n,t,i){i.success&&i.data.forEach(function(i){l(t,i.id,n)})}}})}